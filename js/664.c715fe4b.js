"use strict";(self["webpackChunkmy_flipper_net"]=self["webpackChunkmy_flipper_net"]||[]).push([[664],{7664:(e,t,l)=>{l.r(t),l.d(t,{default:()=>fe});var i=l(9835),a=l(6970);const s={key:0,class:"column flex-center q-my-xl"},n=(0,i._)("p",null,"Waiting for Flipper...",-1),o={key:1,class:"file-container"},r={class:"file-menu flex no-wrap q-pa-xs rounded-borders"},d={class:"q-py-xs q-px-sm bg-grey-3 rounded-borders overflow-hidden-y"},p=(0,i.Uk)(" Upload file "),m=(0,i.Uk)(" Upload folder "),c=(0,i.Uk)(" Create folder "),u={key:0},f={key:1},h={key:2,class:"text-weight-light"},g=(0,i.Uk)(" Download "),w=(0,i.Uk)(" Open in Pulse plotter "),k=(0,i.Uk)(" Rename "),W=(0,i.Uk)(" Delete "),v=(0,i.Uk)(" Download "),_=(0,i.Uk)(" Open in Pulse plotter "),y=(0,i.Uk)(" Rename "),b=(0,i.Uk)(" Delete "),C=(0,i.Uk)(" Empty folder "),q=(0,i._)("div",{class:"text-h6"},"File operation in progress",-1);function x(e,t,l,x,F,P){const U=(0,i.up)("q-spinner"),Z=(0,i.up)("q-btn"),$=(0,i.up)("q-space"),V=(0,i.up)("q-icon"),R=(0,i.up)("q-item-section"),Q=(0,i.up)("q-item"),T=(0,i.up)("q-list"),S=(0,i.up)("q-menu"),E=(0,i.up)("q-item-label"),A=(0,i.up)("q-file"),D=(0,i.up)("q-card-section"),H=(0,i.up)("q-card-actions"),O=(0,i.up)("q-card"),j=(0,i.up)("q-dialog"),I=(0,i.up)("q-input"),z=(0,i.up)("ProgressBar"),B=(0,i.up)("FileEditor"),N=(0,i.up)("q-page"),M=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(N,{class:(0,a.C_)(["column items-center q-pa-md",e.$q.screen.width>960&&e.$q.screen.height>500?"q-mt-xl":"q-mt-xs"])},{default:(0,i.w5)((()=>[e.connected&&e.flags.rpcActive&&!e.flags.rpcToggling?(0,i.kq)("",!0):((0,i.wg)(),(0,i.iD)("div",s,[(0,i.Wm)(U,{color:"primary",size:"3em",class:"q-mb-md"}),n])),e.connected&&e.flags.rpcActive?((0,i.wg)(),(0,i.iD)("div",o,[(0,i._)("div",r,[(0,i.Wm)(Z,{flat:"",dense:"",icon:"arrow_back_ios_new",class:"q-mr-xs",style:{width:"24px"},disabled:"/"===e.path,onClick:t[0]||(t[0]=t=>e.itemClicked({name:".."}))},null,8,["disabled"]),(0,i._)("code",d,(0,a.zw)(e.path),1),(0,i.Wm)($),(0,i.Wm)(Z,{flat:"",dense:"",icon:"mdi-plus",disabled:"/"===e.path},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{"auto-close":"",self:"top middle"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{style:{"min-width":"100px"}},{default:(0,i.w5)((()=>[(0,i.Wm)(Q,{clickable:"",onClick:t[1]||(t[1]=t=>{e.flags.uploadPopup=!0,e.uploadedFiles=null})},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-file-upload-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[p])),_:1})])),_:1}),(0,i.Wm)(Q,{clickable:"",onClick:t[2]||(t[2]=t=>{e.flags.uploadFolderPopup=!0,e.uploadedFiles=null})},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-folder-upload-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[m])),_:1})])),_:1}),(0,i.Wm)(Q,{clickable:"",onClick:t[3]||(t[3]=t=>{e.flags.mkdirPopup=!0,e.editorText=""})},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-folder-plus-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[c])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["disabled"])]),(0,i.Wm)(T,{class:"file-grid"},{default:(0,i.w5)((()=>[((0,i.wg)(!0),(0,i.iD)(i.HY,null,(0,i.Ko)(e.dir,(t=>((0,i.wg)(),(0,i.j4)(Q,(0,i.dG)({key:t.name},t,{dense:"",clickable:"",style:{"border-radius":"3px"}}),{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:"",onClick:l=>e.itemClicked(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:e.itemIconSwitcher(t)},null,8,["name"])])),_:2},1032,["onClick"]),(0,i.Wm)(R,{onClick:l=>e.itemClicked(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(E,null,{default:(0,i.w5)((()=>[(0,i.Uk)((0,a.zw)(t.name),1)])),_:2},1024),"/"===e.path&&"int"===t.name?((0,i.wg)(),(0,i.iD)("span",u,"Flipper internal storage")):(0,i.kq)("",!0),"/"===e.path&&"ext"===t.name?((0,i.wg)(),(0,i.iD)("span",f,"SD card")):(0,i.kq)("",!0),1!==t.type&&t.size?((0,i.wg)(),(0,i.iD)("span",h,(0,a.zw)(t.size)+" bytes",1)):(0,i.kq)("",!0)])),_:2},1032,["onClick"]),(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(Z,{flat:"",dense:"",round:"",icon:"more_vert"},{default:(0,i.w5)((()=>[(0,i.Wm)(S,{"auto-close":"",self:"top middle"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{style:{"min-width":"100px"}},{default:(0,i.w5)((()=>[0===t.type?((0,i.wg)(),(0,i.j4)(Q,{key:0,clickable:"",onClick:l=>e.itemClicked(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-download-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[g])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),t.name.endsWith(".sub")||t.name.endsWith(".ir")?((0,i.wg)(),(0,i.j4)(Q,{key:1,clickable:"",onClick:l=>e.openFileIn(t,"pulse-plotter")},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-share-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[w])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),(0,i.Wm)(Q,{clickable:"",onClick:l=>{e.editorText=t.name,e.oldName=t.name,e.flags.renamePopup=!0}},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-pencil-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[k])),_:1})])),_:2},1032,["onClick"]),(0,i.Wm)(Q,{clickable:"",class:"text-negative",onClick:l=>e.remove(e.path+"/"+t.name,!!t.type)},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-delete-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[W])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:2},1024),(0,i.Wm)(S,{"auto-close":"","touch-position":"","context-menu":"",self:"top middle"},{default:(0,i.w5)((()=>[(0,i.Wm)(T,{style:{"min-width":"100px"}},{default:(0,i.w5)((()=>[0===t.type?((0,i.wg)(),(0,i.j4)(Q,{key:0,clickable:"",onClick:l=>e.itemClicked(t)},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-download-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[v])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),t.name.endsWith(".sub")||t.name.endsWith(".ir")?((0,i.wg)(),(0,i.j4)(Q,{key:1,clickable:"",onClick:l=>e.openFileIn(t,"pulse-plotter")},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-share-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[_])),_:1})])),_:2},1032,["onClick"])):(0,i.kq)("",!0),(0,i.Wm)(Q,{clickable:"",onClick:l=>{e.editorText=t.name,e.oldName=t.name,e.flags.renamePopup=!0}},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-pencil-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[y])),_:1})])),_:2},1032,["onClick"]),(0,i.Wm)(Q,{clickable:"",class:"text-negative",onClick:l=>e.remove(e.path+"/"+t.name,!!t.type)},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:""},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-delete-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[b])),_:1})])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:2},1040)))),128)),0===e.dir.length&&"/"!==e.path?((0,i.wg)(),(0,i.j4)(Q,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(R,{avatar:"",class:"q-ml-xs"},{default:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-folder-outline"})])),_:1}),(0,i.Wm)(R,null,{default:(0,i.w5)((()=>[(0,i.Wm)(E,null,{default:(0,i.w5)((()=>[C])),_:1})])),_:1})])),_:1})):(0,i.kq)("",!0)])),_:1}),(0,i.Wm)(j,{modelValue:e.flags.uploadFolderPopup,"onUpdate:modelValue":t[5]||(t[5]=t=>e.flags.uploadFolderPopup=t)},{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{outlined:"",multiple:"",webkitdirectory:"",modelValue:e.uploadedFiles,"onUpdate:modelValue":t[4]||(t[4]=t=>e.uploadedFiles=t),label:"Drop or select folder",class:"q-pt-md folder-upload",style:(0,a.j5)(e.$q.screen.width>380?"width: 300px;":"")},{prepend:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-folder-upload-outline"})])),_:1},8,["modelValue","style"])])),_:1}),(0,i.Wm)(H,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Upload",onClick:e.upload},null,8,["onClick"]),[[M]]),(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Cancel",color:"negative"},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(j,{modelValue:e.flags.uploadPopup,"onUpdate:modelValue":t[7]||(t[7]=t=>e.flags.uploadPopup=t)},{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,{class:"q-pt-none"},{default:(0,i.w5)((()=>[(0,i.Wm)(A,{outlined:"",multiple:"",modelValue:e.uploadedFiles,"onUpdate:modelValue":t[6]||(t[6]=t=>e.uploadedFiles=t),label:"Drop or select files",class:"q-pt-md",style:(0,a.j5)(e.$q.screen.width>380?"width: 300px;":"")},{prepend:(0,i.w5)((()=>[(0,i.Wm)(V,{name:"mdi-file-upload-outline"})])),_:1},8,["modelValue","style"])])),_:1}),(0,i.Wm)(H,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Upload",onClick:e.upload},null,8,["onClick"]),[[M]]),(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Cancel",color:"negative"},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(j,{modelValue:e.flags.renamePopup,"onUpdate:modelValue":t[11]||(t[11]=t=>e.flags.renamePopup=t)},{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{modelValue:e.editorText,"onUpdate:modelValue":t[8]||(t[8]=t=>e.editorText=t),label:"Rename "+e.oldName,style:(0,a.j5)(e.$q.screen.width>380?"width: 300px;":"")},null,8,["modelValue","label","style"])])),_:1}),(0,i.Wm)(H,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Save",onClick:t[9]||(t[9]=t=>e.rename(e.path,e.oldName,e.editorText))},null,512),[[M]]),(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Cancel",color:"negative",onClick:t[10]||(t[10]=t=>e.editorText="")},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(j,{modelValue:e.flags.mkdirPopup,"onUpdate:modelValue":t[15]||(t[15]=t=>e.flags.mkdirPopup=t)},{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[(0,i.Wm)(I,{modelValue:e.editorText,"onUpdate:modelValue":t[12]||(t[12]=t=>e.editorText=t),label:"Folder name",style:(0,a.j5)(e.$q.screen.width>380?"width: 300px;":"")},null,8,["modelValue","style"])])),_:1}),(0,i.Wm)(H,{align:"right"},{default:(0,i.w5)((()=>[(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Create",onClick:t[13]||(t[13]=t=>e.mkdir(e.path+"/"+e.editorText))},null,512),[[M]]),(0,i.wy)((0,i.Wm)(Z,{flat:"",label:"Cancel",color:"negative",onClick:t[14]||(t[14]=t=>e.editorText="")},null,512),[[M]])])),_:1})])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(j,{modelValue:e.flags.blockingOperationPopup,"onUpdate:modelValue":t[16]||(t[16]=t=>e.flags.blockingOperationPopup=t),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(O,null,{default:(0,i.w5)((()=>[(0,i.Wm)(D,null,{default:(0,i.w5)((()=>[q])),_:1}),e.file.name.length>0?((0,i.wg)(),(0,i.j4)(D,{key:0},{default:(0,i.w5)((()=>[(0,i.Wm)(z,{title:e.file.name,progress:e.file.progress},null,8,["title","progress"])])),_:1})):(0,i.kq)("",!0)])),_:1})])),_:1},8,["modelValue"]),(0,i.Wm)(j,{modelValue:e.editor.active,"onUpdate:modelValue":t[17]||(t[17]=t=>e.editor.active=t),persistent:""},{default:(0,i.w5)((()=>[(0,i.Wm)(B,{path:e.editor.path,name:e.editor.name,content:e.editor.content,onSave:e.save,onClose:e.closeEditor},null,8,["path","name","content","onSave","onClose"])])),_:1},8,["modelValue"])])):(0,i.kq)("",!0)])),_:1},8,["class"])}l(8170),l(5231),l(9359),l(6408),l(6822),l(4110),l(702);var F=l(499),P=l(6646),U=l(9302),Z=l(7593),$=l(1957);const V={class:"cursor-pointer non-selectable"},R=(0,i.Uk)(" File "),Q=(0,i.Uk)("Save"),T=(0,i.Uk)("Close"),S={class:"text-h6"};function E(e,t,l,s,n,o){const r=(0,i.up)("q-item-section"),d=(0,i.up)("q-item"),p=(0,i.up)("q-list"),m=(0,i.up)("q-menu"),c=(0,i.up)("q-space"),u=(0,i.up)("q-btn"),f=(0,i.up)("q-bar"),h=(0,i.up)("q-card-section"),g=(0,i.up)("q-card"),w=(0,i.Q2)("close-popup");return(0,i.wg)(),(0,i.j4)(g,{class:"file-editor",style:{width:"700px","max-width":"80vw"}},{default:(0,i.w5)((()=>[(0,i.Wm)(f,null,{default:(0,i.w5)((()=>[(0,i._)("div",V,[R,(0,i.Wm)(m,null,{default:(0,i.w5)((()=>[(0,i.Wm)(p,{dense:"",style:{"min-width":"100px"}},{default:(0,i.w5)((()=>[(0,i.wy)(((0,i.wg)(),(0,i.j4)(d,{clickable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{onClick:t[0]||(t[0]=e=>this.save())},{default:(0,i.w5)((()=>[Q])),_:1})])),_:1})),[[w]]),(0,i.wy)(((0,i.wg)(),(0,i.j4)(d,{clickable:""},{default:(0,i.w5)((()=>[(0,i.Wm)(r,{onClick:t[1]||(t[1]=t=>e.$emit("close"))},{default:(0,i.w5)((()=>[T])),_:1})])),_:1})),[[w]])])),_:1})])),_:1})]),(0,i._)("div",S,(0,a.zw)(e.name),1),(0,i.Wm)(c),(0,i.Wm)(u,{icon:"close",flat:"",dense:"",onClick:t[2]||(t[2]=t=>e.$emit("close"))})])),_:1}),(0,i.Wm)(h,null,{default:(0,i.w5)((()=>[(0,i.wy)((0,i._)("textarea",{"onUpdate:modelValue":t[3]||(t[3]=t=>e.text=t),id:"textarea",cols:"80"},null,512),[[$.nr,e.text]])])),_:1})])),_:1})}var A=l(1949),D=l.n(A);const H=(0,i.aZ)({name:"FileEditor",props:{path:{type:String,required:!0},name:{type:String,default:""},content:{type:Uint8Array,default:new Uint8Array}},methods:{save(){this.$emit("save",{path:this.path,name:this.name,content:this.text})}},setup(e){const t=new TextDecoder("utf-8"),l=t.decode(e.content);return{text:l}},mounted(){D().bind("mod+s",(e=>{e.preventDefault(),this.save()})),D()(document.querySelector("#textarea")).bind("mod+s",(e=>{e.preventDefault(),this.save()}))}});var O=l(1639),j=l(4458),I=l(4526),z=l(5290),B=l(3246),N=l(490),M=l(1233),L=l(136),G=l(4455),K=l(3190),X=l(2146),Y=l(9984),J=l.n(Y);const ee=(0,O.Z)(H,[["render",E]]),te=ee;J()(H,"components",{QCard:j.Z,QBar:I.Z,QMenu:z.Z,QList:B.Z,QItem:N.Z,QItemSection:M.Z,QSpace:L.Z,QBtn:G.Z,QCardSection:K.Z}),J()(H,"directives",{ClosePopup:X.Z});var le=l(5186);const ie={"files:new":"img:icons/flipper/action-new.svg","files:remove":"img:icons/flipper/action-remove.svg","files:rename":"img:icons/flipper/action-rename.svg","files:save":"img:icons/flipper/action-save.svg","files:sdcard":"img:icons/flipper/location-sdcard.svg","files:internal":"img:icons/flipper/location-internal.svg","files:file":"img:icons/flipper/file.svg","files:folder":"img:icons/flipper/folder.svg","files:badusb":"img:icons/flipper/badusb.svg","files:ibutton":"img:icons/flipper/ibutton.svg","files:infrared":"img:icons/flipper/infrared.svg","files:nfc":"img:icons/flipper/nfc.svg","files:rfid":"img:icons/flipper/rfid.svg","files:subghz":"img:icons/flipper/subghz.svg","files:u2f":"img:icons/flipper/u2f.svg"},ae=(0,i.aZ)({name:"PageFiles",components:{ProgressBar:Z.Z,FileEditor:te},props:{flipper:Object,connected:Boolean,rpcActive:Boolean},setup(){const e=(0,U.Z)();return e.iconMapFn=e=>{const t=ie[e];if(void 0!==t)return{icon:t}},{path:(0,F.iH)("/"),dir:(0,F.iH)([]),flags:(0,F.iH)({rpcActive:!1,rpcToggling:!1,uploadPopup:!1,uploadFolderPopup:!1,renamePopup:!1,mkdirPopup:!1,blockingOperationPopup:!1}),uploadedFiles:(0,F.iH)(null),editorText:(0,F.iH)(""),oldName:(0,F.iH)(""),file:(0,F.iH)({name:"",progress:0}),editor:(0,F.iH)({active:!1,path:"",name:"",content:new Uint8Array})}},watch:{async connected(e,t){e&&await this.start()}},methods:{async startRpc(){this.flags.rpcToggling=!0;const e=await this.flipper.commands.startRpcSession(this.flipper);if(!e.resolved||e.error)throw this.$emit("showNotif",{message:"Unable to start RPC session. Reload the page or reconnect Flipper manually.",color:"negative",reloadBtn:!0}),this.$emit("log",{level:"error",message:"Files: Couldn't start rpc session"}),new Error("Couldn't start rpc session");this.flags.rpcActive=!0,this.flags.rpcToggling=!1,this.$emit("setRpcStatus",!0),this.$emit("log",{level:"info",message:"Files: RPC started"})},async stopRpc(){this.flags.rpcToggling=!0,await this.flipper.commands.stopRpcSession(),this.flags.rpcActive=!1,this.flags.rpcToggling=!1,this.$emit("setRpcStatus",!1),this.$emit("log",{level:"info",message:"Files: RPC stopped"})},async restartRpc(e){this.connected&&(this.rpcActive||e)&&(this.flags.restarting=!0,await this.flipper.closeReader(),await(0,le.Z)(300),await this.flipper.disconnect(),await(0,le.Z)(300),await this.flipper.connect(),await this.startRpc())},async list(){let e=await this.flipper.commands.storage.list(this.path).catch((e=>this.rpcErrorHandler(e,"storage.list"))).finally((()=>{this.$emit("log",{level:"debug",message:"Files: storage.list: "+this.path})}));if(0!==e.length){if("empty response"===e||void 0===e[0])return setTimeout(this.list,300);"/"===this.path&&(e=e.filter((e=>"any"!==e.name))),this.dir=e.sort(((e,t)=>(t.type||0)-e.type))}else this.dir=e},async read(e,t){this.flags.blockingOperationPopup=!0,this.file.name=e.slice(e.lastIndexOf("/")+1);const l=this.dir.find((e=>e.name===this.file.name&&!e.type)),i=l.size;let a=0;const s=this.flipper.emitter.on("storageReadRequest/progress",(e=>{a<e&&(a=e,this.file.progress=Math.min(512*a,i)/i)})),n=await this.flipper.commands.storage.read(e).catch((e=>this.rpcErrorHandler(e,"storage.read"))).finally((()=>{this.$emit("log",{level:"debug",message:"Files: storage.read: "+e})})),o=e.split("/");if(t||(0,P.Z)(o[o.length-1],n),s(),this.flags.blockingOperationPopup=!1,t)return n},async remove(e,t){await this.flipper.commands.storage.remove(e,t).catch((e=>this.rpcErrorHandler(e,"storage.remove"))).finally((()=>{this.$emit("log",{level:"debug",message:`Files: storage.remove: ${e}, recursive: ${t}`})})),this.list()},async rename(e,t,l){await this.flipper.commands.storage.rename(e,t,l).catch((e=>this.rpcErrorHandler(e,"storage.rename"))).finally((()=>{this.$emit("log",{level:"debug",message:`Files: storage.rename: ${e}, old name: ${t}, new name: ${l}`})})),this.list()},async mkdir(e){await this.flipper.commands.storage.mkdir(e).catch((e=>this.rpcErrorHandler(e,"storage.mkdir"))).finally((()=>{this.$emit("log",{level:"debug",message:"Files: storage.mkdir: "+e})})),this.list()},async upload(){if(this.uploadedFiles&&0!==this.uploadedFiles.length){this.flags.blockingOperationPopup=!0;for(const t of this.uploadedFiles){var e;this.file.name=t.name;let l=this.path;if((null===(e=t.webkitRelativePath)||void 0===e?void 0:e.length)>0){const e=t.webkitRelativePath.split("/");e.pop();while(e.length>0)l+="/"+e.shift(),await this.flipper.commands.storage.stat(l).catch((async e=>{if("ERROR_STORAGE_NOT_EXIST"!==e)throw e;await this.flipper.commands.storage.mkdir(l)}))}const i=this.flipper.emitter.on("storageWriteRequest/progress",(e=>{this.file.progress=e.progress/e.total}));await this.flipper.commands.storage.write(l+"/"+t.name,await t.arrayBuffer()).catch((e=>this.rpcErrorHandler(e,"storage.write"))).finally((()=>{this.$emit("log",{level:"debug",message:"Files: storage.write: "+this.path+"/"+t.name})})),i()}this.file.name="",this.list(),this.flags.blockingOperationPopup=!1}},async save(e){const t=new TextEncoder;this.flags.blockingOperationPopup=!0;const l=this.flipper.emitter.on("storageWriteRequest/progress",(e=>{this.file.progress=e.progress/e.total}));await this.flipper.commands.storage.write(e.path+"/"+e.name,t.encode(e.content)).catch((e=>this.rpcErrorHandler(e,"storage.write"))).finally((()=>{this.$emit("log",{level:"debug",message:"Files: storage.write: "+this.path+"/"+e.name})})),l(),this.list(),this.flags.blockingOperationPopup=!1},async openEditor(e,t){this.editor.name=t,this.editor.path=e,this.editor.content=await this.read(e+"/"+t,!0),this.editor.active=!0},closeEditor(){this.editor.active=!1,this.editor.name="",this.editor.path="",this.editor.content=new Uint8Array},async itemClicked(e){1===e.type?(this.path.endsWith("/")||(this.path+="/"),this.path+=e.name,this.list()):".."===e.name?(this.path=this.path.slice(0,this.path.lastIndexOf("/")),0===this.path.length&&(this.path="/"),this.list()):e.name.match(/\.(txt|fmf|ibtn|rfid|ir|nfc|sub|u2f)$/i)?this.openEditor(this.path,e.name):this.read(this.path+"/"+e.name)},async openFileIn(e,t){const l=await this.read(this.path+"/"+e.name,!0);this.$emit("openFileIn",{path:t,file:{name:e.name,data:l}})},itemIconSwitcher(e){return"/"===this.path&&"int"===e.name?"files:internal":"/"===this.path&&"ext"===e.name?"files:sdcard":1===e.type?"mdi-folder-outline":e.name.endsWith(".badusb")?"files:badusb":e.name.endsWith(".ibtn")?"files:ibutton":e.name.endsWith(".ir")?"files:infrared":e.name.endsWith(".nfc")?"files:nfc":e.name.endsWith(".rfid")?"files:rfid":e.name.endsWith(".sub")?"files:subghz":e.name.endsWith(".u2f")?"files:u2f":"mdi-file-outline"},rpcErrorHandler(e,t){e=e.toString(),this.$emit("showNotif",{message:`RPC error in command '${t}': ${e}`,color:"negative"}),this.$emit("log",{level:"error",message:`Files: RPC error in command '${t}': ${e}`})},async start(){this.flags.rpcActive=this.rpcActive,this.rpcActive||(setTimeout((()=>{if(!this.rpcActive)return this.restartRpc(!0)}),1e3),await this.startRpc()),await this.list()}},async mounted(){this.connected&&await this.start()}});var se=l(9885),ne=l(3940),oe=l(2857),re=l(3115),de=l(2074),pe=l(3837),me=l(1821),ce=l(3119);const ue=(0,O.Z)(ae,[["render",x]]),fe=ue;J()(ae,"components",{QPage:se.Z,QSpinner:ne.Z,QBtn:G.Z,QSpace:L.Z,QMenu:z.Z,QList:B.Z,QItem:N.Z,QItemSection:M.Z,QIcon:oe.Z,QItemLabel:re.Z,QDialog:de.Z,QCard:j.Z,QCardSection:K.Z,QFile:pe.Z,QCardActions:me.Z,QInput:ce.Z}),J()(ae,"directives",{ClosePopup:X.Z})}}]);